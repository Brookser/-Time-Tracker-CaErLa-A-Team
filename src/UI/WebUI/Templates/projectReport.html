{% extends "default.html" %}
{% block title %}Project Report{% endblock %}
{% block header %}Project Report{% endblock %}

{% block content %}

<!-- View Mode Toggle -->
<div style="margin-bottom: 20px;">
    <a href="/project-report?view=detailed"><button>ðŸ—‚ View Time Entries</button></a>
    <a href="/project-report?view=summary"><button>ðŸ“Š View Summary</button></a>
</div>

{% if view_mode == "summary" %}
    <form method="get" action="/project-report">
        <input type="hidden" name="view" value="summary">
        <label for="start">Start Date:</label>
        <input type="date" name="start" id="start" value="{{ start or '' }}">
        <label for="end">End Date:</label>
        <input type="date" name="end" id="end" value="{{ end or '' }}">
        <button type="submit">Apply Filter</button>
    </form>

    {% if summary %}
        <table>
            <tr>
                <th>Project Name</th>
                <th>Project ID</th>
                <th>Total Minutes</th>
                <th>Unique Employees</th>
            </tr>
            {% for row in summary %}
            <tr>
                <td>{{ row[0] }}</td>
                <td>{{ row[1] }}</td>
                <td>{{ row[3] or 0 }}</td>
                <td>{{ row[2] }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No data found.</p>
    {% endif %}

{% elif view_mode == "detailed" %}
    <form method="get" action="/project-report">
        <input type="hidden" name="view" value="detailed">
        <label for="project">Select Project:</label>
        <select name="project" id="project">
            <option value="">-- All Projects --</option>
            {% for pid, name in projects %}
                <option value="{{ pid }}" {% if selected_project == pid %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>

        <label for="start">Start Date:</label>
        <input type="date" name="start" id="start" value="{{ start or '' }}">

        <label for="end">End Date:</label>
        <input type="date" name="end" id="end" value="{{ end or '' }}">

        <button type="submit">Filter</button>
    </form>

    {% if entries %}
        <table>
            <tr>
                <th>Employee</th>
                <th>Project</th>
                <th>Start</th>
                <th>Stop</th>
                <th>Minutes</th>
                <th>Notes</th>
            </tr>
            {% for e in entries %}
            <tr>
                <td>{{ e[1] }} {{ e[2] }}</td>
                <td>{{ e[3] }}</td>
                <td>{{ e[4] }}</td>
                <td>{{ e[5] }}</td>
                <td>{{ e[6] }}</td>
                <td>{{ e[7] }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No entries found.</p>
    {% endif %}
{% endif %}

{% endblock %}
